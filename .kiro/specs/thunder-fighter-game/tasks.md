# 任务列表：雷霆战机游戏

## 阶段 1：项目基础设置

- [x] 1.1 初始化项目结构
  - [x] 1.1.1 创建项目目录结构（src/, tests/, assets/）
  - [x] 1.1.2 配置TypeScript（tsconfig.json）
  - [x] 1.1.3 配置Jest测试框架（jest.config.js）
  - [x] 1.1.4 配置fast-check属性测试库
  - [x] 1.1.5 创建HTML入口文件（index.html）
  - [x] 1.1.6 配置构建工具（webpack/vite）

- [x] 1.2 创建核心接口定义
  - [x] 1.2.1 定义GameObject接口
  - [x] 1.2.2 定义Collidable接口
  - [x] 1.2.3 定义Movable接口
  - [x] 1.2.4 定义GameConfig类型
  - [x] 1.2.5 定义枚举类型（GameStateType, EnemyType, BulletOwner, PowerUpType等）

## 阶段 2：核心系统实现

- [x] 2.1 实现游戏引擎（GameEngine）
  - [x] 2.1.1 创建GameEngine类基础结构
  - [x] 2.1.2 实现游戏循环（gameLoop使用requestAnimationFrame）
  - [x] 2.1.3 实现deltaTime计算
  - [x] 2.1.4 实现start/stop/pause/resume方法
  - [x] 2.1.5 集成StateManager

- [x] 2.2 实现状态管理器（StateManager）
  - [x] 2.2.1 创建GameState接口
  - [x] 2.2.2 实现StateManager类
  - [x] 2.2.3 实现MenuState
  - [x] 2.2.4 实现PlayingState
  - [x] 2.2.5 实现PausedState
  - [x] 2.2.6 实现GameOverState
  - [x] 2.2.7 实现状态转换逻辑

- [x] 2.3 实现输入管理器（InputManager）
  - [x] 2.3.1 创建InputState接口
  - [x] 2.3.2 实现键盘事件监听
  - [x] 2.3.3 实现鼠标事件监听
  - [x] 2.3.4 实现键位绑定系统
  - [x] 2.3.5 实现输入状态查询方法

- [x] 2.4 实现实体管理器（EntityManager）
  - [x] 2.4.1 创建EntityManager类
  - [x] 2.4.2 实现实体添加/移除方法
  - [x] 2.4.3 实现按类型查询实体方法
  - [x] 2.4.4 实现批量更新和渲染
  - [x] 2.4.5 实现延迟添加/移除机制

## 阶段 3：游戏实体实现

- [x] 3.1 实现玩家飞机（PlayerAircraft）
  - [x] 3.1.1 创建PlayerAircraft类基础结构
  - [x] 3.1.2 实现移动逻辑（move方法）
  - [x] 3.1.3 实现边界约束
  - [x] 3.1.4 实现射击逻辑（fire方法）
  - [x] 3.1.5 实现射击频率限制
  - [x] 3.1.6 实现武器升级系统
  - [x] 3.1.7 实现生命值管理（takeDamage, heal）
  - [x] 3.1.8 实现无敌状态逻辑
  - [x] 3.1.9 实现碰撞检测
  - [x] 3.1.10 实现渲染方法

- [x] 3.2 实现敌机（EnemyAircraft）
  - [x] 3.2.1 创建EnemyAircraft类基础结构
  - [x] 3.2.2 实现基础敌机（BASIC）移动模式
  - [x] 3.2.3 实现射击敌机（SHOOTER）逻辑
  - [x] 3.2.4 实现之字形敌机（ZIGZAG）移动模式
  - [x] 3.2.5 实现Boss敌机逻辑
  - [x] 3.2.6 实现生命值和伤害系统
  - [x] 3.2.7 实现碰撞检测
  - [x] 3.2.8 实现渲染方法

- [x] 3.3 实现子弹（Bullet）
  - [x] 3.3.1 创建Bullet类基础结构
  - [x] 3.3.2 实现子弹移动逻辑
  - [x] 3.3.3 实现玩家子弹和敌机子弹区分
  - [x] 3.3.4 实现碰撞检测
  - [x] 3.3.5 实现超出边界自动清理
  - [x] 3.3.6 实现渲染方法

- [x] 3.4 实现道具（PowerUp）
  - [x] 3.4.1 创建PowerUp类基础结构
  - [x] 3.4.2 实现道具移动逻辑
  - [x] 3.4.3 实现武器升级道具效果
  - [x] 3.4.4 实现生命恢复道具效果
  - [x] 3.4.5 实现护盾道具效果
  - [x] 3.4.6 实现碰撞检测
  - [x] 3.4.7 实现渲染方法

## 阶段 4：游戏系统实现

- [x] 4.1 实现碰撞检测系统（CollisionSystem）
  - [x] 4.1.1 创建CollisionSystem类
  - [x] 4.1.2 实现AABB矩形碰撞检测算法
  - [x] 4.1.3 实现玩家子弹与敌机碰撞检测
  - [x] 4.1.4 实现敌机子弹与玩家碰撞检测
  - [x] 4.1.5 实现玩家与敌机碰撞检测
  - [x] 4.1.6 实现玩家与道具碰撞检测
  - [x] 4.1.7 实现碰撞事件处理
  - [ ]* 4.1.8 实现空间分区优化（可选）

- [x] 4.2 实现生成系统（SpawnSystem）
  - [x] 4.2.1 创建SpawnSystem类
  - [x] 4.2.2 实现敌机生成逻辑
  - [x] 4.2.3 实现敌机类型选择算法
  - [x] 4.2.4 实现难度递增系统
  - [x] 4.2.5 实现道具生成逻辑
  - [x] 4.2.6 实现Boss生成触发条件
  - [x] 4.2.7 实现生成频率动态调整

- [x] 4.3 实现得分系统（ScoreSystem）
  - [x] 4.3.1 创建ScoreSystem类
  - [x] 4.3.2 实现得分累加逻辑
  - [x] 4.3.3 实现敌机击毁计数
  - [x] 4.3.4 实现准确率计算
  - [x] 4.3.5 实现连续击毁奖励系统
  - [x] 4.3.6 实现最高分本地存储
  - [x] 4.3.7 实现得分重置功能

- [x] 4.4 实现渲染系统（RenderSystem）
  - [x] 4.4.1 创建RenderSystem类
  - [x] 4.4.2 实现背景滚动渲染
  - [x] 4.4.3 实现实体渲染（精灵图或占位符）
  - [x] 4.4.4 实现UI渲染（得分、生命值）
  - [x] 4.4.5 实现爆炸动画效果
  - [x] 4.4.6 实现粒子系统
  - [x] 4.4.7 实现渲染层次管理

- [x] 4.5 实现音频管理器（AudioManager）
  - [x] 4.5.1 创建AudioManager类
  - [x] 4.5.2 实现音效加载和播放
  - [x] 4.5.3 实现背景音乐循环播放
  - [x] 4.5.4 实现音量控制
  - [x] 4.5.5 实现静音切换
  - [x] 4.5.6 实现音频资源错误处理

## 阶段 5：单元测试

- [x] 5.1 测试玩家飞机（PlayerAircraft）
  - [x] 5.1.1 测试初始化状态
  - [x] 5.1.2 测试移动功能
  - [x] 5.1.3 测试边界约束
  - [x] 5.1.4 测试射击功能
  - [x] 5.1.5 测试武器升级
  - [x] 5.1.6 测试生命值管理
  - [x] 5.1.7 测试无敌状态

- [x] 5.2 测试敌机（EnemyAircraft）
  - [x] 5.2.1 测试不同类型敌机初始化
  - [x] 5.2.2 测试移动模式
  - [x] 5.2.3 测试射击逻辑
  - [x] 5.2.4 测试生命值和伤害

- [x] 5.3 测试子弹（Bullet）
  - [x] 5.3.1 测试子弹移动
  - [x] 5.3.2 测试子弹所有者区分
  - [x] 5.3.3 测试超出边界清理

- [x] 5.4 测试道具（PowerUp）
  - [x] 5.4.1 测试道具移动
  - [x] 5.4.2 测试道具效果应用

- [x] 5.5 测试碰撞检测系统（CollisionSystem）
  - [x] 5.5.1 测试AABB碰撞算法
  - [x] 5.5.2 测试各类碰撞检测
  - [x] 5.5.3 测试边界碰撞情况

- [x] 5.6 测试生成系统（SpawnSystem）
  - [x] 5.6.1 测试敌机生成
  - [x] 5.6.2 测试难度递增
  - [x] 5.6.3 测试道具生成概率

- [x] 5.7 测试得分系统（ScoreSystem）
  - [x] 5.7.1 测试得分累加
  - [x] 5.7.2 测试准确率计算
  - [x] 5.7.3 测试本地存储

- [x] 5.8 测试状态管理器（StateManager）
  - [x] 5.8.1 测试状态转换
  - [x] 5.8.2 测试无效状态转换处理

## 阶段 6：属性测试

- [x] 6.1 属性测试：边界约束不变量（属性1）
  **验证需求：1.1, 1.2**
  **Validates: Requirements 1.1, 1.2**

- [x] 6.2 属性测试：射击频率限制（属性2）
  **验证需求：1.4**
  **Validates: Requirements 1.4**

- [x] 6.3 属性测试：武器升级效果（属性3）
  **验证需求：3.5**
  **Validates: Requirements 3.5**

- [x] 6.4 属性测试：敌机生成位置约束（属性4）
  **验证需求：2.1**
  **Validates: Requirements 2.1**

- [x] 6.5 属性测试：实体移动方向一致性（属性5）
  **验证需求：2.2, 7.2**
  **Validates: Requirements 2.2, 7.2**

- [x] 6.6 属性测试：超出边界实体清理（属性6）
  **验证需求：2.3, 3.2, 3.3**
  **Validates: Requirements 2.3, 3.2, 3.3**

- [x] 6.7 属性测试：难度递增单调性（属性7）
  **验证需求：2.5**
  **Validates: Requirements 2.5**

- [x] 6.8 属性测试：子弹速度差异（属性8）
  **验证需求：3.4**
  **Validates: Requirements 3.4**

- [x] 6.9 属性测试：AABB碰撞检测正确性（属性9）
  **验证需求：4.1**
  **Validates: Requirements 4.1**

- [x] 6.10 属性测试：碰撞伤害效果（属性10）
  **验证需求：4.2, 4.3**
  **Validates: Requirements 4.2, 4.3**

- [x] 6.11 属性测试：道具效果应用（属性11）
  **验证需求：4.4, 7.3, 7.4**
  **Validates: Requirements 4.4, 7.3, 7.4**

- [x] 6.12 属性测试：生命值耗尽触发游戏结束（属性12）
  **验证需求：5.3**
  **Validates: Requirements 5.3**

- [x] 6.13 属性测试：得分累加正确性（属性13）
  **验证需求：6.1, 6.2**
  **Validates: Requirements 6.1, 6.2**

- [x] 6.14 属性测试：最高分持久化往返（属性14）
  **验证需求：6.4, 6.5**
  **Validates: Requirements 6.4, 6.5**

- [x] 6.15 属性测试：道具生成概率（属性15）
  **验证需求：7.1**
  **Validates: Requirements 7.1**

- [x] 6.16 属性测试：临时效果时效性（属性16）
  **验证需求：7.5**
  **Validates: Requirements 7.5**

- [x] 6.17 属性测试：游戏状态转换有效性（属性17）
  **验证需求：8.1, 8.3**
  **Validates: Requirements 8.1, 8.3**

- [x] 6.18 属性测试：游戏重置完整性（属性18）
  **验证需求：8.4, 1.5, 5.1**
  **Validates: Requirements 8.4, 1.5, 5.1**

- [x] 6.19 属性测试：音量控制有效性（属性19）
  **验证需求：10.5**
  **Validates: Requirements 10.5**

## 阶段 7：集成与优化

- [x] 7.1 集成测试
  - [x] 7.1.1 测试完整游戏流程（开始→游戏中→游戏结束）
  - [x] 7.1.2 测试暂停和恢复功能
  - [x] 7.1.3 测试得分持久化往返
  - [x] 7.1.4 测试多个系统协同工作

- [x] 7.2 性能优化
  - [x] 7.2.1 实现对象池（子弹、敌机）
  - [ ] 7.2.2 优化碰撞检测性能
  - [ ] 7.2.3 优化渲染性能
  - [ ] 7.2.4 确保60FPS稳定运行

- [x] 7.3 错误处理和容错
  - [x] 7.3.1 实现资源加载错误处理
  - [x] 7.3.2 实现运行时错误恢复
  - [x] 7.3.3 实现降级运行策略
  - [x] 7.3.4 添加错误日志系统

## 阶段 8：资源和美化

- [x] 8.1 准备游戏资源
  - [x] 8.1.1 创建或获取精灵图（玩家飞机、敌机、子弹、道具）
  - [x] 8.1.2 创建或获取背景图
  - [x] 8.1.3 创建或获取音效文件
  - [x] 8.1.4 创建或获取背景音乐

- [x] 8.2 UI美化
  - [x] 8.2.1 设计开始菜单界面
  - [x] 8.2.2 设计游戏中UI（得分、生命值显示）
  - [x] 8.2.3 设计暂停菜单
  - [x] 8.2.4 设计游戏结束界面
  - [x] 8.2.5 添加按钮悬停效果

- [x] 8.3 视觉效果增强
  - [x] 8.3.1 优化爆炸动画
  - [x] 8.3.2 添加粒子效果
  - [x] 8.3.3 添加玩家受伤闪烁效果
  - [x] 8.3.4 添加背景滚动效果

## 阶段 9：游戏集成与完善

- [x] 9.1 完成游戏主循环集成
  - [x] 9.1.1 在main.ts中初始化GameEngine
  - [x] 9.1.2 注册所有游戏状态（Menu, Playing, Paused, GameOver）
  - [x] 9.1.3 集成玩家控制与输入管理器
  - [x] 9.1.4 集成碰撞检测系统到游戏循环
  - [x] 9.1.5 集成生成系统到游戏循环
  - [x] 9.1.6 集成得分系统到游戏循环
  - [x] 9.1.7 集成渲染系统到游戏循环
  - [x] 9.1.8 集成音频管理器到游戏循环

- [x] 9.2 编写文档
  - [x] 9.2.1 编写README.md（项目介绍、安装、运行）
  - [x] 9.2.2 编写代码注释
  - [x] 9.2.3 编写API文档
  - [x] 9.2.4 编写游戏玩法说明

- [x] 9.3 部署准备
  - [x] 9.3.1 配置生产环境构建
  - [x] 9.3.2 优化资源加载
  - [ ] 9.3.3 测试不同浏览器兼容性
  - [ ] 9.3.4 部署到Web服务器或GitHub Pages

## 阶段 10：测试和发布

- [ ] 10.1 最终测试
  - [ ] 10.1.1 运行所有单元测试
  - [ ] 10.1.2 运行所有属性测试
  - [ ] 10.1.3 运行集成测试
  - [ ] 10.1.4 检查代码覆盖率（目标：80%+）
  - [ ] 10.1.5 进行手动游戏测试

- [ ] 10.2 发布
  - [ ] 10.2.1 创建发布版本
  - [ ] 10.2.2 发布到生产环境
  - [ ] 10.2.3 收集用户反馈
  - [ ] 10.2.4 规划后续改进

## 注意事项

- 所有属性测试必须使用注释标记，格式：`// Feature: thunder-fighter-game, Property X: 属性名称`
- 属性测试至少运行100次迭代（CI环境中500次）
- 单元测试和属性测试应该并行开发，不要等到所有功能完成后再写测试
- 每个阶段完成后进行代码审查和测试验证
- 优先实现核心功能，可选功能（标记*）可以在后期添加
